<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cartitas Beta Simplificada</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
  input, textarea, button { font-size: 1em; margin-top: 8px; width: 100%; padding: 6px; }
  button { cursor: pointer; }
  button:disabled { background: #ccc; cursor: not-allowed; }
  .cartita { border: 1px solid #ccc; margin-top: 10px; padding: 8px; border-radius: 6px; }
  .footer { font-size: 0.8em; color: #555; margin-top: 4px; display: flex; justify-content: space-between; }
  #mensajeConfirmacion { margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>

<h2>Cartitas Beta Simplificada</h2>

<label for="nombre">Tu nombre:</label>
<input id="nombre" type="text" placeholder="Pon tu nombre aquí" />
<button id="guardarNombreBtn">Guardar Nombre</button>
<div id="nombreMsg" style="color: red; margin-top: 5px;"></div>

<label for="mensaje">Mensaje:</label>
<textarea id="mensaje" rows="3" placeholder="Escribí tu carta aquí..."></textarea>

<button id="enviarBtn" disabled>Enviar Carta</button>

<div id="mensajeConfirmacion"></div>

<h3>Mis Cartas Enviadas</h3>
<div id="misCartas"></div>

<script>
const nombreInput = document.getElementById('nombre');
const guardarNombreBtn = document.getElementById('guardarNombreBtn');
const nombreMsg = document.getElementById('nombreMsg');
const mensajeInput = document.getElementById('mensaje');
const enviarBtn = document.getElementById('enviarBtn');
const mensajeConfirmacion = document.getElementById('mensajeConfirmacion');
const misCartasDiv = document.getElementById('misCartas');

let usuario = null;
let cartas = [];

function cargarUsuario() {
  const u = localStorage.getItem('usuario');
  if (u) return JSON.parse(u);
  return null;
}

function guardarUsuario(nick) {
  localStorage.setItem('usuario', JSON.stringify({ nick }));
  usuario = { nick };
}

function cargarCartas() {
  const c = localStorage.getItem('cartas');
  if (c) return JSON.parse(c);
  return [];
}

function guardarCartas() {
  localStorage.setItem('cartas', JSON.stringify(cartas));
}

function validarEnvio() {
  if (usuario && mensajeInput.value.trim().length > 2) {
    enviarBtn.disabled = false;
  } else {
    enviarBtn.disabled = true;
  }
}

function mostrarCartas() {
  misCartasDiv.innerHTML = '';
  if (cartas.length === 0) {
    misCartasDiv.innerHTML = '<p>No has enviado cartas aún.</p>';
    return;
  }
  cartas.forEach(carta => {
    const div = document.createElement('div');
    div.classList.add('cartita');
    div.innerHTML = `<strong>${carta.autor}:</strong> ${carta.texto}`;
    misCartasDiv.appendChild(div);
  });
}

guardarNombreBtn.addEventListener('click', () => {
  const nombre = nombreInput.value.trim();
  if (nombre.length === 0) {
    nombreMsg.textContent = 'El nombre no puede estar vacío.';
    return;
  }
  nombreMsg.textContent = '';
  guardarUsuario(nombre);
  nombreInput.disabled = true;
  guardarNombreBtn.disabled = true;
  validarEnvio();
  mensajeConfirmacion.textContent = `Nombre guardado como "${nombre}". Ya podés enviar cartas.`;
});

mensajeInput.addEventListener('input', validarEnvio);

enviarBtn.addEventListener('click', () => {
  const texto = mensajeInput.value.trim();
  if (!usuario) {
    mensajeConfirmacion.style.color = 'red';
    mensajeConfirmacion.textContent = 'Primero guardá tu nombre.';
    return;
  }
  if (texto.length < 3) {
    mensajeConfirmacion.style.color = 'red';
    mensajeConfirmacion.textContent = 'El mensaje es demasiado corto.';
    return;
  }
  const nuevaCarta = {
    autor: usuario.nick,
    texto,
    fecha: new Date().toISOString(),
  };
  cartas.push(nuevaCarta);
  guardarCartas();
  mostrarCartas();
  mensajeConfirmacion.style.color = 'green';
  mensajeConfirmacion.textContent = 'Carta enviada con éxito!';
  mensajeInput.value = '';
  validarEnvio();
});

function init() {
  usuario = cargarUsuario();
  if (usuario) {
    nombreInput.value = usuario.nick;
    nombreInput.disabled = true;
    guardarNombreBtn.disabled = true;
    mensajeConfirmacion.textContent = `Bienvenido, ${usuario.nick}!`;
  }
  cartas = cargarCartas();
  mostrarCartas();
  validarEnvio();
}

init();
</script>

</body>
</html>

