<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat con bloqueo de nombre y usuarios</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  #usuarios { margin-bottom: 10px; }
  #chat { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; margin-bottom: 10px; }
  #mensaje { width: 80%; }
  #nombre { width: 200px; }
  .bloqueado { color: red; font-weight: bold; }
  .usuario-conectado { color: green; margin-right: 5px; }
  .mencion { color: blue; font-weight: bold; }
</style>
</head>
<body>

<h2>Chat Simulado - Conejo Ol칤mpico style 游냟游볞</h2>

<label>Tu nombre: 
  <input id="nombre" type="text" />
</label>
<button id="btnCambiarNombre">Cambiar nombre</button>
<button id="btnBloquearNombre">Bloquear nombre por 7 d칤as</button>
<span id="mensajeBloqueo" class="bloqueado"></span>

<div>
  <h4>Usuarios conectados (simulado):</h4>
  <div id="usuarios"></div>
</div>

<div id="chat"></div>

<input id="mensaje" type="text" placeholder="Escribe tu mensaje aqu칤... Usa @usuario para mencionar." />
<button id="btnEnviar">Enviar</button>

<script>
(() => {
  const nombreInput = document.getElementById('nombre');
  const btnCambiarNombre = document.getElementById('btnCambiarNombre');
  const btnBloquearNombre = document.getElementById('btnBloquearNombre');
  const mensajeBloqueo = document.getElementById('mensajeBloqueo');
  const usuariosDiv = document.getElementById('usuarios');
  const chatDiv = document.getElementById('chat');
  const mensajeInput = document.getElementById('mensaje');
  const btnEnviar = document.getElementById('btnEnviar');

  // Simulaci칩n de usuarios conectados (localStorage)
  // Para simular m칰ltiples usuarios, se usar치n keys con timestamps y nombres en localStorage

  // --- Manejo del nombre y bloqueo ---
  const NOMBRE_KEY = 'chatNombreUsuario';
  const FECHA_CAMBIO_KEY = 'chatFechaCambioNombre';
  const BLOQUEO_KEY = 'chatNombreBloqueado';

  function cargarNombre() {
    let nombre = localStorage.getItem(NOMBRE_KEY) || '';
    nombreInput.value = nombre;
  }

  function puedeCambiarNombre() {
    const bloqueo = localStorage.getItem(BLOQUEO_KEY);
    if (bloqueo === 'true') return false;

    const fechaStr = localStorage.getItem(FECHA_CAMBIO_KEY);
    if (!fechaStr) return true;

    const fechaCambio = new Date(fechaStr);
    const ahora = new Date();
    const diffDias = (ahora - fechaCambio) / (1000 * 60 * 60 * 24);
    return diffDias >= 7;
  }

  function actualizarMensajeBloqueo() {
    if (!puedeCambiarNombre()) {
      mensajeBloqueo.textContent = 'Tu nombre est치 bloqueado para cambiar por 7 d칤as.';
      nombreInput.disabled = true;
      btnCambiarNombre.disabled = true;
      btnBloquearNombre.disabled = true;
    } else {
      mensajeBloqueo.textContent = '';
      nombreInput.disabled = false;
      btnCambiarNombre.disabled = false;
      btnBloquearNombre.disabled = false;
    }
  }

  btnCambiarNombre.addEventListener('click', () => {
    if (!puedeCambiarNombre()) {
      alert('No puedes cambiar tu nombre hasta que pasen 7 d칤as.');
      return;
    }
    const nuevoNombre = nombreInput.value.trim();
    if (!nuevoNombre) {
      alert('El nombre no puede estar vac칤o.');
      return;
    }
    localStorage.setItem(NOMBRE_KEY, nuevoNombre);
    localStorage.setItem(FECHA_CAMBIO_KEY, new Date().toISOString());
    localStorage.setItem(BLOQUEO_KEY, 'false');
    alert('Nombre cambiado a: ' + nuevoNombre);
    actualizarMensajeBloqueo();
    registrarUsuarioConectado(nuevoNombre);
  });

  btnBloquearNombre.addEventListener('click', () => {
    localStorage.setItem(BLOQUEO_KEY, 'true');
    actualizarMensajeBloqueo();
    alert('Has bloqueado tu nombre por 7 d칤as. No podr치s cambiarlo hasta que desbloquees.');
  });

  // --- Manejo usuarios conectados simulado ---
  // Al cargar la p치gina, registra usuario actual
  // Y muestra la lista (desde localStorage)

  const USUARIOS_KEY = 'chatUsuariosConectados';

  function obtenerUsuarios() {
    const json = localStorage.getItem(USUARIOS_KEY);
    if (!json) return [];
    return JSON.parse(json);
  }

  function guardarUsuarios(usuarios) {
    localStorage.setItem(USUARIOS_KEY, JSON.stringify(usuarios));
  }

  // Para simular usuario conectado, guardamos su nombre y timestamp (칰ltima actividad)
  function registrarUsuarioConectado(nombre) {
    if (!nombre) return;
    let usuarios = obtenerUsuarios();
    // Actualiza si ya est치
    const ahora = Date.now();
    const index = usuarios.findIndex(u => u.nombre === nombre);
    if (index >= 0) {
      usuarios[index].ultimoActivo = ahora;
    } else {
      usuarios.push({ nombre, ultimoActivo: ahora });
    }
    guardarUsuarios(usuarios);
    mostrarUsuarios();
  }

  // Limpiar usuarios inactivos > 1 min (simulaci칩n)
  function limpiarUsuariosInactivos() {
    let usuarios = obtenerUsuarios();
    const ahora = Date.now();
    usuarios = usuarios.filter(u => ahora - u.ultimoActivo < 60 * 1000);
    guardarUsuarios(usuarios);
    mostrarUsuarios();
  }

  function mostrarUsuarios() {
    const usuarios = obtenerUsuarios();
    usuariosDiv.innerHTML = '';
    usuarios.forEach(u => {
      const span = document.createElement('span');
      span.textContent = u.nombre;
      span.classList.add('usuario-conectado');
      usuariosDiv.appendChild(span);
    });
  }

  // Cada 20 segundos limpiar usuarios inactivos (simulaci칩n)
  setInterval(() => {
    limpiarUsuariosInactivos();
  }, 20000);

  // Al cargar la p치gina, registrar usuario actual
  cargarNombre();
  actualizarMensajeBloqueo();
  registrarUsuarioConectado(nombreInput.value.trim());

  // Actualiza el registro de usuario cuando cambia nombre (al menos al escribir)
  nombreInput.addEventListener('input', () => {
    registrarUsuarioConectado(nombreInput.value.trim());
  });

  // --- Chat b치sico con @usuario ---
  function crearMensajeHTML(nombre, texto) {
    // Reemplaza @usuario por span azul
    const textoHTML = texto.replace(/@(\w+)/g, (match, p1) => {
      return `<span class="mencion">@${p1}</span>`;
    });
    return `<b>${nombre}:</b> ${textoHTML}`;
  }

  btnEnviar.addEventListener('click', () => {
    const nombre = localStorage.getItem(NOMBRE_KEY) || 'An칩nimo';
    const texto = mensajeInput.value.trim();
    if (!texto) return alert('Escribe un mensaje.');

    // Mostrar mensaje
    const mensajeHTML = crearMensajeHTML(nombre, texto);
    const div = document.createElement('div');
    div.innerHTML = mensajeHTML;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
    mensajeInput.value = '';
  });

  // Optional: Enter key to send
  mensajeInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      btnEnviar.click();
    }
  });

})();
</script>

</body>
</html>


